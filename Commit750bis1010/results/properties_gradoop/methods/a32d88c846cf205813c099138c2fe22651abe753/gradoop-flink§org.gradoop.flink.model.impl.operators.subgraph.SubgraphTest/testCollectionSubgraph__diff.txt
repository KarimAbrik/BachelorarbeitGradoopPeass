@Test
public void testCollectionSubgraph() throws Exception {
    FlinkAsciiGraphLoader loader = getSocialNetworkLoader();
    loader.appendToDatabaseFromString("(jay:Person {" + "name : \"Jay\", age : 45, gender : \"f\", city : \"Leipzig\"})" + "g4:Community [" + "(jay)-[jkb:knows {since : 2016}]->(bob)" + "(bob)-[blj:likes]->(jay)" + "]");
    loader.appendToDatabaseFromString("expected0:Community {interest : \"Databases\", vertexCount : 3} [" + "(alice)" + "(bob)" + "]");
    loader.appendToDatabaseFromString("expected1:Community {interest : \"Hadoop\", vertexCount : 3} []");
    loader.appendToDatabaseFromString("expected4:Community [" + "(jay)-[jkb]->(bob)" + "]");
    GraphCollection input = loader.getGraphCollectionByVariables("g0", "g1", "g4");
    FilterFunction<EPGMVertex> vertexFilterFunction = v -> {
        PropertyValue city = v.getPropertyValue("city");
        return city != null && city.toString().equals("Leipzig");
    };
    FilterFunction<EPGMEdge> edgeFilterFunction = e -> {
        if (e.getLabel().equals("knows")) {
            return e.getPropertyValue("since").getInt() == 2016;
        }
        return false;
    };
    GraphCollection result = input.apply(new ApplySubgraph<>(vertexFilterFunction, edgeFilterFunction, Subgraph.Strategy.BOTH));
    collectAndAssertTrue(result.equalsByGraphElementIds(loader.getGraphCollectionByVariables("expected0", "expected1", "expected4")));
    collectAndAssertTrue(result.equalsByGraphData(loader.getGraphCollectionByVariables("expected0", "expected1", "expected4")));
}